# WLF Payload CMS - Incident Report & Diagnostics

> **Date:** 2026-01-29  
> **Status:** CMS Down (502 Bad Gateway)  
> **Root Cause:** DNS pointing to deleted VPS

---

## üî¥ Current Status

| Component | Status | Details |
|-----------|--------|---------|
| **CMS URL** | üî¥ 502 | `https://cms.wlf.com.mx` returning Bad Gateway |
| **Dokploy VPS** | üü¢ Alive | `143.198.49.232` (dokploy-factory-v1) |
| **Payload Service** | üü¢ Running | 1/1 replicas (restarted manually) |
| **MongoDB** | üü¢ Healthy | `mongo-wjsixq` running |
| **Traefik** | üü¢ Configured | Routes for `cms.wlf.com.mx` exist |

---

## üîç Root Cause Analysis

### The Problem Chain:

```
User visits https://cms.wlf.com.mx
        ‚Üì
Cloudflare Proxy (104.21.94.137 / 172.67.168.80)
        ‚Üì
Origin IP: 146.190.42.201 ‚Üê DELETED VPS!
        ‚Üì
502 Bad Gateway
```

### Key Findings:

1. **Old VPS IP** `146.190.42.201` no longer exists in DigitalOcean
2. **New Dokploy VPS** is at `143.198.49.232` (droplet: `dokploy-factory-v1`)
3. **Cloudflare DNS** for `wlf.com.mx` is in a **separate Cloudflare account** (not `2L72MKUpAyhU3C0hrcOXL6XMFh9kur1QimmNwe6k`)
4. **Payload CMS service** was scaled to 0 replicas (manually restarted)
5. **Traefik configuration** exists and is correct for `cms.wlf.com.mx`

---

## üõ†Ô∏è Resolution Steps

### Immediate Fix Required:

**Update Cloudflare A Record:**

1. Log into the Cloudflare account that manages `wlf.com.mx`
2. Go to DNS settings
3. Update the `cms` A record from `146.190.42.201` ‚Üí `143.198.49.232`
4. Ensure it's **Proxied** (orange cloud) for SSL

### Alternative (Direct Access):

If you can't update DNS immediately, access the CMS directly:
- **Direct URL**: `http://143.198.49.232` (via Traefik with Host header)
- **Dokploy Dashboard**: `http://143.198.49.232:3000`

---

## üìä Infrastructure Status

### DigitalOcean Droplets (as of 2026-01-29):

| ID | Name | IP | Status | Memory |
|----|------|-------|--------|--------|
| 467484383 | us | 64.23.253.66 | active | 1GB |
| 509959576 | Coolify | 24.199.96.58 | active | 16GB |
| 540579097 | lifeos | 143.198.136.235 | active | 8GB |
| 545073149 | lifeos2026 | 64.227.103.76 | active | 4GB |
| 547261821 | zen | 137.184.180.74 | active | 16GB |
| **547947927** | **dokploy-factory-v1** | **143.198.49.232** | **active** | **4GB** |

### Missing/Deleted:

- `146.190.42.201` - Previous Dokploy VPS (now deleted)

---

## üßπ Service Recovery Commands

Used to restore the Payload CMS service:

```bash
# Check service status
ssh root@143.198.49.232 "docker service ls"

# View service logs
ssh root@143.198.49.232 "docker service logs payload-cms-uk3xw9 --tail 50"

# Restart/scale service
ssh root@143.198.49.232 "docker service scale payload-cms-uk3xw9=1"

# Check Traefik routes
ssh root@143.198.49.232 "cat /etc/dokploy/traefik/dynamic/payload-cms-uk3xw9.yml"
```

---

## ‚ö†Ô∏è Secondary Findings

### 1. ImportMap Warning (Non-Critical)

The Payload logs show repeated warnings:
```
getFromImportMap: PayloadComponent not found in importMap {
  key: '@payloadcms/storage-s3/client#S3ClientUploadHandler',
  ...
}
```

**Fix:** Run `payload generate:importmap` before build, or update Dockerfile to include this step.

### 2. No Email Adapter

```
WARN: No email adapter provided. Email will be written to console.
```

**Fix:** Add Resend, Nodemailer, or SMTP adapter if email functionality is needed.

### 3. API Token Mismatch

The old Dokploy API token `zenUooTFaLChcnmDWjxmBdMoNIGWeIgVJufkWaHuIGNeHMopaPVHtqHwDTdtYzRNfgh` returns 401 on the new VPS.

**Fix:** Generate a new API token from `http://143.198.49.232:3000/dashboard/settings/profile`

---

## üìù Files to Update

After DNS is fixed:

1. `/root/zen/list_dokploy_resources.py` - Update `API_URL` to new IP
2. `/root/zen/MASTER_PROMPT.md` - Update VPS IP reference
3. `/root/zen/.secrets/` - Add new Dokploy API token

---

## üè∑Ô∏è Related Documentation

- `docs/GIT_HISTORY.md` - Complete project evolution
- `docs/ARCHITECTURE.md` - Split-Head architecture
- `MASTER_PROMPT.md` - Project context

---

*This incident report should be updated once DNS is fixed and service is confirmed working.*
